# 项目的由来
## 背景
我需要长期维护自己的 NixOS 与 Home Manager 环境，未来可能涉及多台设备与多用户配置。
为避免配置分散、重复且难以复用，仓库被整理为 Flake 结构，并做了清晰的层级拆分。

## 动机
- 可复现：重装或换机时能快速恢复环境。
- 可移植：同一份配置可在不同硬件与不同用户上复用。
- 可维护：系统、用户、桌面分层管理，减少耦合。
- 可扩展：通过 profile 开关按需启用软件与桌面组件。

## 目标
- 以统一的 registry 管理 hosts 与 users，并自动生成 nixosConfigurations。
- 以分层结构组织代码，明确系统层、用户层与桌面层职责。
- 统一样式与主题配置，保证桌面体验一致。
- 新增主机/用户/软件时尽量减少改动范围。

## 非目标
- 不做通用框架或模板库，只服务当前需求。
- 不追求覆盖所有发行版或桌面环境。
- 不把所有软件都强制模块化。
- 不保证对所有上游变化保持零成本适配。

## 关键决策
- 使用 Flake 作为入口，`flake.nix` 仅负责组合 profiles 与输出系统配置。
- hosts/users 采用 registry + profile 模式，避免在入口处硬编码。
- 设立 desktop 层处理系统与用户共享的桌面逻辑与样式。
- 通过 `config.profile.{users,hosts}` 与 `config.profile.style` 进行注入，降低模块间耦合。
- 通过 `enable` 开关统一控制功能与软件包的启用。
